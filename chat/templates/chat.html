{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Chat Bot</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸ¤– AI Chat Bot</h1>
      <p class="subtitle">Local LLM powered by Ollama â€” private, fast & secure</p>
    </header>
    
    <div class="chat-box">
      <div id="chat">
        <div class="empty-state">Start a conversation â€” ask me anything!</div>
      </div>
      <div class="input-area">
        <input 
          id="message" 
          placeholder="Type your message..." 
          onkeydown="if(event.key==='Enter' && !event.shiftKey) { sendMessage(); event.preventDefault(); }"
        />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <script>
    async function sendMessage() {
      const input = document.getElementById("message");
      const text = input.value.trim();
      if (!text) return;

      const chat = document.getElementById("chat");
      
      // Remove empty state if present
      const emptyState = chat.querySelector(".empty-state");
      if (emptyState) emptyState.remove();

      addMessage(text, "user");
      input.value = "";

      try {
        const res = await fetch("/api/chat/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });

        if (!res.ok) throw new Error("Server error");
        const data = await res.json();
        addMessage(data.response || "No response received", "bot");
      } catch (err) {
        addMessage("Error: " + err.message, "bot");
      }
    }

    function addMessage(text, sender) {
      const chat = document.getElementById("chat");
      const div = document.createElement("div");
      div.className = `msg ${sender}`;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>